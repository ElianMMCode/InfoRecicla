â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘                 IMPLEMENTACIÃ“N DEL ENDPOINT PASO A PASO                      â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


PASO 1: CREAR EL DTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Archivo: src/main/java/.../dto/MaterialSearchDTO.java

package org.sena.inforecicla.dto;

public class MaterialSearchDTO {
    private String id;
    private String nombre;
    private String unidad;
    private String categoria;

    public MaterialSearchDTO() {}

    public MaterialSearchDTO(String id, String nombre, String unidad, String categoria) {
        this.id = id;
        this.nombre = nombre;
        this.unidad = unidad;
        this.categoria = categoria;
    }

    // Getters
    public String getId() { return id; }
    public String getNombre() { return nombre; }
    public String getUnidad() { return unidad; }
    public String getCategoria() { return categoria; }

    // Setters
    public void setId(String id) { this.id = id; }
    public void setNombre(String nombre) { this.nombre = nombre; }
    public void setUnidad(String unidad) { this.unidad = unidad; }
    public void setCategoria(String categoria) { this.categoria = categoria; }
}


PASO 2: CREAR EL SERVICIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Archivo: src/main/java/.../service/MaterialSearchService.java

package org.sena.inforecicla.service;

import org.sena.inforecicla.dto.MaterialSearchDTO;
import org.sena.inforecicla.entity.Material; // Cambia por tu entity
import org.sena.inforecicla.repository.MaterialRepository; // Tu repository
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class MaterialSearchService {

    @Autowired
    private MaterialRepository materialRepository;

    public List<MaterialSearchDTO> buscar(String texto, String categoria, String tipo) {
        // Obtener todos los materiales
        List<Material> materiales = materialRepository.findAll();

        // Filtrar por texto (bÃºsqueda en nombre)
        if (texto != null && !texto.isEmpty()) {
            materiales = materiales.stream()
                .filter(m -> m.getNombre().toLowerCase().contains(texto.toLowerCase()))
                .collect(Collectors.toList());
        }

        // Filtrar por categorÃ­a
        if (categoria != null && !categoria.isEmpty()) {
            materiales = materiales.stream()
                .filter(m -> m.getCategoria() != null &&
                        m.getCategoria().getNombre().equalsIgnoreCase(categoria))
                .collect(Collectors.toList());
        }

        // Filtrar por tipo
        if (tipo != null && !tipo.isEmpty()) {
            materiales = materiales.stream()
                .filter(m -> m.getTipo() != null &&
                        m.getTipo().getNombre().equalsIgnoreCase(tipo))
                .collect(Collectors.toList());
        }

        // Mapear a DTO
        return materiales.stream()
            .map(m -> new MaterialSearchDTO(
                m.getId().toString(),
                m.getNombre(),
                m.getUnidadMedida(),
                m.getCategoria() != null ? m.getCategoria().getNombre() : "N/A"
            ))
            .collect(Collectors.toList());
    }
}


PASO 3: CREAR EL CONTROLLER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Archivo: src/main/java/.../controller/CatalogoController.java

package org.sena.inforecicla.controller;

import org.sena.inforecicla.dto.MaterialSearchDTO;
import org.sena.inforecicla.service.MaterialSearchService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import java.util.List;

@RestController
@RequestMapping("/api/catalogo")
@CrossOrigin(origins = "*")
public class CatalogoController {

    @Autowired
    private MaterialSearchService materialSearchService;

    @GetMapping("/materiales/buscar")
    public ResponseEntity<List<MaterialSearchDTO>> buscarMateriales(
        @RequestParam(required = false, defaultValue = "") String texto,
        @RequestParam(required = false, defaultValue = "") String categoria,
        @RequestParam(required = false, defaultValue = "") String tipo
    ) {
        try {
            System.out.println("Buscando materiales: texto=" + texto + ", categoria=" + categoria + ", tipo=" + tipo);

            List<MaterialSearchDTO> resultados = materialSearchService.buscar(texto, categoria, tipo);

            System.out.println("Encontrados " + resultados.size() + " materiales");

            return ResponseEntity.ok(resultados);
        } catch (Exception e) {
            System.err.println("Error en bÃºsqueda de materiales: " + e.getMessage());
            e.printStackTrace();
            return ResponseEntity.status(500).build();
        }
    }
}


PASO 4: VERIFICAR QUE EL REPOSITORY EXISTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Verifica que tienes:

@Repository
public interface MaterialRepository extends JpaRepository<Material, Long> {
}

Si no existe, crÃ©alo con esta interfaz.


PASO 5: PROBAR EL ENDPOINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Arranca la aplicaciÃ³n
2. Navega a: http://localhost:8080/[tu-url]/materiales
3. Abre consola (F12)
4. Haz click en "AGREGAR"
5. Verifica en consola:
   - "ğŸ” Click en AGREGAR"
   - "Buscando en: /api/catalogo/materiales/buscar"
   - "Respuesta status: 200"
   - "Datos recibidos: [...]"
6. Los materiales deberÃ­an aparecer en el modal

Si ves "Respuesta status: 404":
  - El endpoint no estÃ¡ registrado
  - Verifica que @RestController estÃ© bien
  - Verifica que @RequestMapping sea correcta

Si ves error "No constructor found":
  - El DTO no tiene constructor vacÃ­o
  - Agrega: public MaterialSearchDTO() {}


PASO 6: VERIFICAR EN LA BD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Verifica que existen materiales en la tabla material:

SELECT * FROM material;

Si estÃ¡ vacÃ­a, agrega algunos:

INSERT INTO material (nombre, unidad_medida, id_categoria, id_tipo)
VALUES ('Botella PET', 'unidad', 1, 1);

INSERT INTO material (nombre, unidad_medida, id_categoria, id_tipo)
VALUES ('CartÃ³n', 'kg', 2, 2);


PASO 7: DEPURACIÃ“N (SI ALGO FALLA)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Agrega estos logs al servicio:

public List<MaterialSearchDTO> buscar(String texto, String categoria, String tipo) {
    System.out.println("=== BÃšSQUEDA DE MATERIALES ===");
    System.out.println("Texto: " + texto);
    System.out.println("CategorÃ­a: " + categoria);
    System.out.println("Tipo: " + tipo);

    List<Material> materiales = materialRepository.findAll();
    System.out.println("Materiales en BD: " + materiales.size());

    // ... filtrado ...

    System.out.println("Materiales despuÃ©s de filtrado: " + resultados.size());
    return resultados;
}

Y verifica el output en la consola de Spring Boot.


CHECKLIST FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ CreÃ© MaterialSearchDTO.java
â–¡ CreÃ© MaterialSearchService.java
â–¡ CreÃ© CatalogoController.java
â–¡ VerifiquÃ© que MaterialRepository existe
â–¡ La aplicaciÃ³n arranca sin errores
â–¡ Navego a la secciÃ³n de materiales
â–¡ Hago click en AGREGAR
â–¡ El modal se abre
â–¡ En consola veo "Respuesta status: 200"
â–¡ Los materiales aparecen en el modal
â–¡ Puedo seleccionar un material
â–¡ El formulario se abre pre-rellenado

SI TODO ESTO FUNCIONA = Â¡COMPLETADO! âœ“


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

