<!--doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>InfoRecicla • Administración (Módulos)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../components/admin-styles.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div id="navbar-container"></div>
    <div class="container-fluid">
        <div class="row min-vh-100">

            <!-- Sidebar (módulos) >
            <aside
                class="col-12 col-lg-3 col-xl-2 bg-success-subtle border-end border-success-subtle p-3 position-sticky top-0"
                style="height:100vh; overflow:auto;">
                <div class="d-flex align-items-center gap-2 mb-3">
                    <span class="badge rounded-pill text-bg-success">Admin</span>
                    <strong class="text-success">InfoRecicla</strong>
                </div>
                <div class="small text-success fw-semibold mb-2">Módulos</div>
                <div class="list-group">
                    <a href="#resumen"
                        class="list-group-item list-group-item-action active bg-success border-success">Resumen</a>
                    <a href="#mod-usuarios" class="list-group-item list-group-item-action">Usuarios</a>
                    <a href="#mod-ecas" class="list-group-item list-group-item-action">Puntos ECA</a>
                    <a href="#mod-materiales" class="list-group-item list-group-item-action">Materiales & Catálogos</a>
                    {{--
                    <a href="#mod-contenido" class="list-group-item list-group-item-action">Contenido</a> Oculto
                    temporalmente módulo Publicaciones
                    <a href="#mod-mensajeria" class="list-group-item list-group-item-action">Mensajería</a>
                    <a href="#mod-reportes" class="list-group-item list-group-item-action">Reportes & Auditoría</a>
                    <a href="#mod-sistema" class="list-group-item list-group-item-action">Sistema</a>
                    --}}
                </div>
            </aside>

            <!-- Main >
            <main class="col-12 col-lg-9 col-xl-10 p-3 p-lg-4">
                <!-- Topbar simple >
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h1 class="h5 text-success m-0">Panel de Administración</h1>
                        <a href="../admin.html" class="btn btn-link text-success p-0">
                            <i class="fas fa-arrow-left"></i> Volver al Panel Principal
                        </a>
                    </div>
                    <span class="badge text-bg-success">Elian</span>
                </div>

                <!-- ====== MÓDULO: PUNTOS ECA ====== >
                <section id="mod-ecas" class="mb-5">
                    <h2 class="h5 text-success mb-2">Puntos ECA</h2>
                    <ul class="nav nav-pills mb-3">
                        <li class="nav-item"><a href="#ecas-resumen" class="nav-link active bg-success">Resumen</a>
                        </li>
                        <li class="nav-item"><a href="#ecas-listado" class="nav-link">Listado</a></li>
                        <li class="nav-item"><a href="#ecas-crear" class="nav-link">Crear</a></li>
                        <li class="nav-item"><a href="#programaciones" class="nav-link">Programaciones</a></li>
                    </ul>

                    <div id="ecas-resumen" class="mb-3">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="card border-success h-100">
                                    <div class="card-body">
                                        <div class="text-success">ECAs activos</div>
                                        <div class="display-6 text-success">{{ $totalPuntosECAactivos }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="ecas-listado" class="mb-3">
                        <div class="card border-success mb-2">
                            <div class="card-body">
                                <form method="GET" action="#mod-ecas" class="row g-2">
                                    <div class="col-12 col-md">
                                        <label class="form-label text-success">Buscar</label>
                                        <input class="form-control" name="buscar_eca"
                                            value="{{ request('buscar_eca') }}" placeholder="nombre, dirección…">
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <label class="form-label text-success">Estado</label>
                                        <select class="form-select" name="estado_eca">
                                            <option value="">Todos</option>
                                            <option value="activo" @if(request('estado_eca')=='activo' ) selected
                                                @endif>activo</option>
                                            <option value="inactivo" @if(request('estado_eca')=='inactivo' ) selected
                                                @endif>inactivo</option>
                                            <option value="bloqueado" @if(request('estado_eca')=='bloqueado' ) selected
                                                @endif>bloqueado</option>
                                        </select>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <label class="form-label text-success">Gestor</label>
                                        <input class="form-control" name="gestor_eca"
                                            value="{{ request('gestor_eca') }}" placeholder="Nombre gestor">
                                    </div>
                                    <div class="col-12 col-md-auto d-flex align-items-end">
                                        <button type="submit" class="btn btn-outline-success">Aplicar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="card border-success">
                            <div class="table-responsive">
                                <form method="POST" action="{{ route('admin.eca.update') }}">
                                    @csrf
                                    <table class="table table-hover m-0">
                                        <thead class="table-success">
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Gestor</th>
                                                <th>Dirección</th>
                                                <th>Estado</th>
                                                <th class="text-end">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @forelse($puntosECA as $punto)
                                            <tr>
                                                <td><input type="text" name="nombre[{{ $punto->id }}]"
                                                        value="{{ $punto->nombre }}"
                                                        class="form-control form-control-sm"></td>
                                                <td>
                                                    @if($punto->gestor)
                                                    {{ $punto->gestor->nombre }} {{ $punto->gestor->apellido }}
                                                    @else
                                                    <span class="text-muted">Sin gestor</span>
                                                    @endif
                                                </td>
                                                <td><input type="text" name="direccion[{{ $punto->id }}]"
                                                        value="{{ $punto->direccion }}"
                                                        class="form-control form-control-sm"></td>
                                                <td>
                                                    <select name="estado[{{ $punto->id }}]"
                                                        class="form-select form-select-sm">
                                                        <option value="activo" @if($punto->estado=='activo') selected
                                                            @endif>activo</option>
                                                        <option value="inactivo" @if($punto->estado=='inactivo')
                                                            selected @endif>inactivo</option>
                                                        <option value="bloqueado" @if($punto->estado=='bloqueado')
                                                            selected @endif>bloqueado</option>
                                                    </select>
                                                </td>
                                                <td class="text-end">
                                                    <button type="submit" name="editar" value="{{ $punto->id }}"
                                                        class="btn btn-sm btn-outline-success">Guardar</button>
                                                    <button type="submit" name="eliminar" value="{{ $punto->id }}"
                                                        class="btn btn-sm btn-outline-danger"
                                                        onclick="return confirm('¿Eliminar este punto ECA?')">Eliminar</button>
                                                </td>
                                            </tr>
                                            @empty
                                            <tr>
                                                <td colspan="5" class="text-center">No hay puntos ECA registrados.</td>
                                            </tr>
                                            @endforelse
                                        </tbody>
                                    </table>
                                </form>
                                <div class="p-2">
                                    {{ $puntosECA->links('pagination::bootstrap-4') }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="ecas-crear" class="mb-3">
                        <div class="card border-success">
                            <div class="card-body">
                                <form method="POST" action="{{ route('admin.eca.store') }}" id="ecaForm" novalidate
                                    enctype="multipart/form-data" class="vstack gap-4">
                                    @csrf
                                    <input type="hidden" name="tipo" value="GestorECA">
                                    <input type="hidden" name="account_type" value="eca">

                                    <p class="small text-success fw-bold mb-1">Datos de cuenta</p>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="correo" class="form-label small fw-semibold">Correo electrónico
                                                (acceso)</label>
                                            <input type="email"
                                                class="form-control form-control-sm @error('correo') is-invalid @enderror"
                                                id="correo" name="correo" value="{{ old('correo') }}"
                                                autocomplete="email" required>
                                            @error('correo')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-3">
                                            <label for="password"
                                                class="form-label small fw-semibold">Contraseña</label>
                                            <input type="password"
                                                class="form-control form-control-sm @error('password') is-invalid @enderror"
                                                id="password" name="password" minlength="8" maxlength="64" required>
                                            @error('password')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-3">
                                            <label for="password_confirmation"
                                                class="form-label small fw-semibold">Confirmar</label>
                                            <input type="password"
                                                class="form-control form-control-sm @error('password_confirmation') is-invalid @enderror"
                                                id="password_confirmation" name="password_confirmation" required>
                                            @error('password_confirmation')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                    </div>

                                    <p class="small text-success fw-bold mb-1 mt-2">Datos del gestor (propietario del
                                        punto)
                                    </p>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="nombre" class="form-label small fw-semibold">Nombres</label>
                                            <input type="text"
                                                class="form-control form-control-sm @error('nombre') is-invalid @enderror"
                                                id="nombre" name="nombre" value="{{ old('nombre') }}" required>
                                            @error('nombre')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-6">
                                            <label for="apellido" class="form-label small fw-semibold">Apellidos</label>
                                            <input type="text"
                                                class="form-control form-control-sm @error('apellido') is-invalid @enderror"
                                                id="apellido" name="apellido" value="{{ old('apellido') }}" required>
                                            @error('apellido')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-4">
                                            <label for="tipoDocumento" class="form-label small fw-semibold">Tipo de
                                                documento</label>
                                            <select id="tipoDocumento" name="tipoDocumento"
                                                class="form-select form-select-sm @error('tipoDocumento') is-invalid @enderror"
                                                required>
                                                <option value="" disabled {{ old('tipoDocumento') ? '' : 'selected' }}>
                                                    Selecciona...</option>
                                                @php($docs = ['Cédula de Ciudadanía', 'Cédula de Extranjería', 'Tarjeta
                                                de Identidad', 'Pasaporte'])
                                                @foreach ($docs as $doc)
                                                <option value="{{ $doc }}" {{ old('tipoDocumento')===$doc ? 'selected'
                                                    : '' }}>
                                                    {{ $doc }}
                                                </option>
                                                @endforeach
                                            </select>
                                            @error('tipoDocumento')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-4">
                                            <label for="numeroDocumento" class="form-label small fw-semibold">Número de
                                                documento</label>
                                            <input type="text"
                                                class="form-control form-control-sm @error('numeroDocumento') is-invalid @enderror"
                                                id="numeroDocumento" name="numeroDocumento"
                                                value="{{ old('numeroDocumento') }}" minlength="5" maxlength="20"
                                                required>
                                            @error('numeroDocumento')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                    </div>

                                    <p class="small text-success fw-bold mb-1 mt-2">Información de la estación</p>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="nombrePunto" class="form-label small fw-semibold">Nombre del
                                                Punto
                                                ECA</label>
                                            <input type="text"
                                                class="form-control form-control-sm @error('nombrePunto') is-invalid @enderror"
                                                id="nombrePunto" name="nombrePunto" value="{{ old('nombrePunto') }}"
                                                required>
                                            @error('nombrePunto')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-3">
                                            <label for="nit" class="form-label small fw-semibold">NIT
                                                (opcional)</label>
                                            <input type="text"
                                                class="form-control form-control-sm @error('nit') is-invalid @enderror"
                                                id="nit" name="nit" value="{{ old('nit') }}" maxlength="20"
                                                placeholder="Si aplica">
                                            @error('nit')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                    </div>
                                    <div class="row g-3 mt-1">
                                        <div class="col-md-6">
                                            <label for="horarioAtencion" class="form-label small fw-semibold">Horario de
                                                atención (opcional)</label>
                                            <input type="text"
                                                class="form-control form-control-sm @error('horarioAtencion') is-invalid @enderror"
                                                id="horarioAtencion" name="horarioAtencion"
                                                value="{{ old('horarioAtencion') }}"
                                                placeholder="Lun-Vie 8:00–17:00, Sáb 9:00–13:00">
                                            @error('horarioAtencion')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                    </div>
                                    <div class="row g-3 mt-1">
                                        <div class="col-md-6">
                                            <label for="correoPunto" class="form-label small fw-semibold">Correo de
                                                contacto del punto</label>
                                            <input type="email"
                                                class="form-control form-control-sm @error('correoPunto') is-invalid @enderror"
                                                id="correoPunto" name="correoPunto" value="{{ old('correoPunto') }}"
                                                placeholder="Puede ser distinto al de acceso" required>
                                            @error('correoPunto')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-6">
                                            <label for="telefonoPunto" class="form-label small fw-semibold">Teléfono de
                                                contacto del punto</label>
                                            <input type="tel"
                                                class="form-control form-control-sm @error('telefonoPunto') is-invalid @enderror"
                                                id="telefonoPunto" name="telefonoPunto"
                                                value="{{ old('telefonoPunto') }}" inputmode="tel" pattern="^\d{10}$"
                                                maxlength="10" placeholder="Ej: 3XXXXXXXXX" required>
                                            @error('telefonoPunto')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                    </div>
                                    <div class="row g-3 mt-1">
                                        <div class="col-md-6">
                                            <label for="direccionPunto" class="form-label small fw-semibold">Dirección
                                                del
                                                punto</label>
                                            <input type="text"
                                                class="form-control form-control-sm @error('direccionPunto') is-invalid @enderror"
                                                id="direccionPunto" name="direccionPunto"
                                                value="{{ old('direccionPunto') }}" required>
                                            @error('direccionPunto')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-3">
                                            <label for="ciudad" class="form-label small fw-semibold">Ciudad</label>
                                            <select id="ciudad" name="ciudad"
                                                class="form-select form-select-sm @error('ciudad') is-invalid @enderror"
                                                required>
                                                <option value="" disabled {{ old('ciudad') ? '' : 'selected' }}>
                                                    Selecciona...</option>
                                                <option value="Bogotá" {{ old('ciudad')==='Bogotá' ? 'selected' : '' }}>
                                                    Bogotá</option>
                                            </select>
                                            @error('ciudad')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-3">
                                            <label for="localidadPunto"
                                                class="form-label small fw-semibold">Localidad</label>
                                            <select id="localidadPunto" name="localidadPunto"
                                                class="form-select form-select-sm @error('localidadPunto') is-invalid @enderror"
                                                required>
                                                <option value="" disabled {{ old('localidadPunto') ? '' : 'selected' }}>
                                                    Selecciona localidad...
                                                </option>
                                                @php($locs = ['Usaquén', 'Chapinero', 'Santa Fe', 'San Cristóbal',
                                                'Usme', 'Tunjuelito', 'Bosa', 'Kennedy', 'Fontibón', 'Engativá', 'Suba',
                                                'Barrios Unidos', 'Teusaquillo', 'Los Mártires', 'Antonio Nariño',
                                                'Puente Aranda', 'La Candelaria', 'Rafael Uribe', 'Ciudad Bolívar',
                                                'Sumapaz'])
                                                @foreach ($locs as $l)
                                                <option value="{{ $l }}" {{ old('localidadPunto')===$l ? 'selected' : ''
                                                    }}>
                                                    {{ $l }}
                                                </option>
                                                @endforeach
                                            </select>
                                            @error('localidadPunto')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <label class="form-label small fw-semibold mb-1">Ubicación (opcional)</label>
                                        <div class="row g-2 align-items-start">
                                            <div class="col-12 col-md-4">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-text">Lat</span>
                                                    <input type="text" class="form-control" id="latitudVisible"
                                                        placeholder="Ej: 4.609710" value="{{ old('latitud') }}">
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-4">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-text">Lng</span>
                                                    <input type="text" class="form-control" id="longitudVisible"
                                                        placeholder="Ej: -74.081749" value="{{ old('longitud') }}">
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-4 d-grid d-md-block">
                                                <button type="button" id="geoBtn"
                                                    class="btn btn-outline-success btn-sm w-100">GPS</button>
                                            </div>
                                        </div>
                                        <div id="locationDisplay" class="form-text mt-1">Pulsa GPS para solicitar
                                            permiso
                                            al navegador y capturar tu ubicación precisa.</div>
                                        <input type="hidden" id="latitud" name="latitud" value="{{ old('latitud') }}">
                                        <input type="hidden" id="longitud" name="longitud"
                                            value="{{ old('longitud') }}">
                                    </div>
                                    <div class="row g-3 mt-1">
                                        <div class="col-md-6">
                                            <label for="logo" class="form-label small fw-semibold">Logo del punto
                                                (opcional)</label>
                                            <input type="file"
                                                class="form-control form-control-sm @error('logo') is-invalid @enderror"
                                                id="logo" name="logo" accept="image/*">
                                            @error('logo')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-6">
                                            <label for="foto" class="form-label small fw-semibold">Foto del punto
                                                (opcional)</label>
                                            <input type="file"
                                                class="form-control form-control-sm @error('foto') is-invalid @enderror"
                                                id="foto" name="foto" accept="image/*">
                                            @error('foto')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                        <div class="col-md-6">
                                            <label for="sitioWeb" class="form-label small fw-semibold">Sitio web
                                                (opcional)</label>
                                            <input type="url"
                                                class="form-control form-control-sm @error('sitioWeb') is-invalid @enderror"
                                                id="sitioWeb" name="sitioWeb" value="{{ old('sitioWeb') }}"
                                                placeholder="https://">
                                            @error('sitioWeb')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                            @enderror
                                        </div>
                                    </div>
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="checkbox" value="1" id="mostrarMapa"
                                            name="mostrarMapa" {{ old('mostrarMapa') ? 'checked' : '' }} required>
                                        <label class="form-check-label small" for="mostrarMapa">Mostrar el punto en el
                                            mapa público cuando sea aprobado.</label>
                                    </div>
                                    <div class="form-check mt-2">
                                        <input class="form-check-input" type="checkbox" value="1"
                                            id="recibeNotificaciones" name="recibeNotificaciones" {{
                                            old('recibeNotificaciones') ? 'checked' : '' }} required>
                                        <label class="form-check-label small" for="recibeNotificaciones">Deseo recibir
                                            notificaciones (aprobaciones, comentarios, etc.).</label>
                                    </div>

                                    <div class="d-grid mt-3">
                                        <button type="submit" class="btn btn-success">Registrar Punto ECA</button>
                                    </div>
                                    <p class="text-center mt-3 mb-0 small">¿Ya tienes cuenta? <a
                                            href="{{ route('login') }}">Inicia sesión</a></p>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div id="programaciones">
                    </div>
                </section>
                <footer class="text-center small text-success-50 pt-3">© InfoRecicla — Panel de Administración modular
                </footer>
            </main>

        </div>
        <script src="../components/load-components.js"></script>
</body>

</html-->

<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Puntos ECA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid py-4">
        <!-- ====== MÓDULO: PUNTOS ECA ====== -->
        <section id="mod-ecas" class="mb-5">
            <h2 class="h5 text-success mb-2">Puntos ECA</h2>
            <ul class="nav nav-pills mb-3">
                <li class="nav-item">
                    <a href="#ecas-resumen" class="nav-link active bg-success">Resumen</a>
                </li>
                <li class="nav-item">
                    <a th:href="@{/puntos-eca/listado}" class="nav-link">Listado</a>
                </li>
                <li class="nav-item">
                    <a th:href="@{/puntos-eca/crear}" class="nav-link">Crear</a>
                </li>
                <li class="nav-item">
                    <a href="#programaciones" class="nav-link">Programaciones</a>
                </li>
            </ul>

            <div id="ecas-resumen" class="mb-3">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="card border-success h-100">
                            <div class="card-body">
                                <div class="text-success">ECAs activos</div>
                                <div class="display-6 text-success" th:text="${totalPuntosECAactivos}">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-warning h-100">
                            <div class="card-body">
                                <div class="text-warning">ECAs inactivos</div>
                                <div class="display-6 text-warning" th:text="${totalPuntosECAinactivos}">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-info h-100">
                            <div class="card-body">
                                <div class="text-info">Total ECAs</div>
                                <div class="display-6 text-info" th:text="${totalPuntosECA}">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="programaciones" class="mt-4">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">Programaciones Recientes</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">No hay programaciones recientes.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>