<!--doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>InfoRecicla • Administración (Módulos)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../components/admin-styles.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div id="navbar-container"></div>
    <div class="container-fluid">
        <div class="row min-vh-100">

            <!-- Sidebar (módulos) >
            <aside
                class="col-12 col-lg-3 col-xl-2 bg-success-subtle border-end border-success-subtle p-3 position-sticky top-0"
                style="height:100vh; overflow:auto;">
                <div class="d-flex align-items-center gap-2 mb-3">
                    <span class="badge rounded-pill text-bg-success">Admin</span>
                    <strong class="text-success">InfoRecicla</strong>
                </div>
                <div class="small text-success fw-semibold mb-2">Módulos</div>
                <div class="list-group">
                    <a href="#resumen"
                        class="list-group-item list-group-item-action active bg-success border-success">Resumen</a>
                    <a href="#mod-usuarios" class="list-group-item list-group-item-action">Usuarios</a>
                    <a href="#mod-ecas" class="list-group-item list-group-item-action">Puntos ECA</a>
                    <a href="#mod-materiales" class="list-group-item list-group-item-action">Materiales & Catálogos</a>
                    {{--
                    <a href="#mod-contenido" class="list-group-item list-group-item-action">Contenido</a> Oculto
                    temporalmente módulo Publicaciones
                    <a href="#mod-mensajeria" class="list-group-item list-group-item-action">Mensajería</a>
                    <a href="#mod-reportes" class="list-group-item list-group-item-action">Reportes & Auditoría</a>
                    <a href="#mod-sistema" class="list-group-item list-group-item-action">Sistema</a>
                    --}}
                </div>
            </aside>

            <!-- Main >
            <main class="col-12 col-lg-9 col-xl-10 p-3 p-lg-4">
                <!-- Topbar simple >
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h1 class="h5 text-success m-0">Panel de Administración</h1>
                        <a href="../admin.html" class="btn btn-link text-success p-0">
                            <i class="fas fa-arrow-left"></i> Volver al Panel Principal
                        </a>
                    </div>
                    <span class="badge text-bg-success">Elian</span>
                </div>

                <!-- ====== MÓDULO: MATERIALES & CATÁLOGOS ====== >
                <section id="mod-materiales" class="mb-5">
                    <h2 class="h5 text-success mb-2">Materiales & Catálogos</h2>
                    <ul class="nav nav-pills mb-3">
                        <li class="nav-item"><a href="#materiales-resumen"
                                class="nav-link active bg-success">Resumen</a></li>
                        <li class="nav-item"><a href="#materiales-listado" class="nav-link">Materiales</a></li>
                        <li class="nav-item"><a href="#materiales-crear" class="nav-link">Crear</a></li>
                        <li class="nav-item"><a href="#tipos" class="nav-link">Tipos</a></li>
                        <li class="nav-item"><a href="#categorias-material" class="nav-link">Categorías</a></li>
                    </ul>

                    <div id="materiales-resumen" class="row g-3 mb-3">
                        <div class="col-md-4">
                            <div class="card border-success h-100">
                                <div class="card-body">
                                    <div class="text-success">Materiales</div>
                                    <div class="display-6 text-success">{{ $totalMateriales }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-success h-100">
                                <div class="card-body">
                                    <div class="text-success">Categorías</div>
                                    <div class="display-6 text-success">{{ $totalCategorias }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-success h-100">
                                <div class="card-body">
                                    <div class="text-success">Tipos</div>
                                    <div class="display-6 text-success">{{ $totalTipos }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="materiales-listado" class="card border-success mb-3">
                        <div class="card-body">
                            <form class="row g-2" method="GET" action="{{ url('admin') }}">
                                <div class="col-12 col-md">
                                    <label class="form-label text-success">Buscar</label>
                                    <input class="form-control" name="buscar_material"
                                        value="{{ request('buscar_material') }}" placeholder="nombre, descripción…">
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label text-success">Categoría</label>
                                    <select class="form-select" name="categoria_material">
                                        <option value="">Todas</option>
                                        @foreach($categorias as $c)
                                        <option value="{{ $c->id }}" @if(request('categoria_material')==$c->id) selected
                                            @endif>{{ $c->nombre }}</option>
                                        @endforeach
                                    </select>
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label text-success">Tipo</label>
                                    <select class="form-select" name="tipo_material">
                                        <option value="">Todos</option>
                                        @foreach($tipos as $t)
                                        <option value="{{ $t->id }}" @if(request('tipo_material')==$t->id) selected
                                            @endif>{{ $t->nombre }}</option>
                                        @endforeach
                                    </select>
                                </div>
                                <div class="col-12 col-md-auto d-flex align-items-end">
                                    <button class="btn btn-outline-success" type="submit">Aplicar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="card border-success mb-3">
                        <div class="table-responsive">
                            <table class="table table-hover m-0">
                                <thead class="table-success">
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Descripción</th>
                                        <th>Categoría</th>
                                        <th>Tipo</th>
                                        <th>Imagen URL</th>
                                        <th class="text-end">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach($materiales as $material)
                                    <tr>
                                        <form method="POST" action="{{ url('materiales/update/' . $material->id) }}">
                                            @csrf
                                            <td><input type="text" name="nombre" value="{{ $material->nombre }}"
                                                    class="form-control form-control-sm" required></td>
                                            <td><input type="text" name="descripcion"
                                                    value="{{ $material->descripcion }}"
                                                    class="form-control form-control-sm"></td>
                                            <td>
                                                <select name="categoria_id" class="form-select form-select-sm">
                                                    @foreach($categorias as $c)
                                                    <option value="{{ $c->id }}" @if($material->categoria_id == $c->id)
                                                        selected @endif>{{ $c->nombre }}</option>
                                                    @endforeach
                                                </select>
                                            </td>
                                            <td>
                                                <select name="tipo_id" class="form-select form-select-sm">
                                                    @foreach($tipos as $t)
                                                    <option value="{{ $t->id }}" @if($material->tipo_id == $t->id)
                                                        selected @endif>{{ $t->nombre }}</option>
                                                    @endforeach
                                                </select>
                                            </td>
                                            <td><input type="url" name="imagen_url" value="{{ $material->imagen_url }}"
                                                    class="form-control form-control-sm"></td>
                                            <td class="text-end">
                                                <button type="submit" class="btn btn-sm btn-success">Guardar</button>
                                                <a class="btn btn-sm btn-outline-danger" href="#">Eliminar</a>
                                            </td>
                                        </form>
                                    </tr>
                                    @endforeach
                                </tbody>
                            </table>
                            <div class="card-footer d-flex justify-content-between align-items-center">
                                <span class="small text-success">Mostrando {{ $materiales->count() }} de {{
                                    $materiales->total() }}</span>
                                <div>
                                    {{ $materiales->links('pagination::bootstrap-4') }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="materiales-crear" class="card border-success mb-3">
                        <div class="card-body">
                            <form id="formMaterial" name="formMaterial" class="row g-3" method="POST"
                                action="{{ route('materiales.store') }}">
                                @csrf
                                <div class="col-md-6"><label for="nombre_material"
                                        class="form-label text-success">Nombre</label><input id="nombre_material"
                                        name="nombre" class="form-control" required></div>
                                <div class="col-md-6"><label for="descripcion_material"
                                        class="form-label text-success">Descripción</label>
                                    <textarea id="descripcion_material" name="descripcion"
                                        class="form-control"></textarea>
                                </div>
                                <div class="col-md-6"><label for="tipo_id"
                                        class="form-label text-success">Tipo</label><select id="tipo_id"
                                        class="form-select" name="tipo_id" required>
                                        <option value="" disabled selected>Selecciona…</option>
                                        @foreach ($tipos as $t)
                                        <option value="{{ $t->id }}">{{ $t->nombre }}</option>
                                        @endforeach
                                    </select></div>
                                <div class="col-md-6"><label for="categoria_id"
                                        class="form-label text-success">Categoría</label><select id="categoria_id"
                                        class="form-select" name="categoria_id" required>
                                        <option value="" disabled selected>Selecciona…</option>
                                        @foreach ($categorias as $c)
                                        <option value="{{ $c->id }}">{{ $c->nombre }}</option>
                                        @endforeach
                                    </select></div>

                                <div class="col-md-6"><label for="imagen_url" class="form-label text-success">Imagen
                                        URL</label><input id="imagen_url" name="imagen_url" type="url"
                                        class="form-control"></div>
                                <div class="col-12"><button class="btn btn-success" type="submit">Guardar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <footer class="text-center small text-success-50 pt-3">© InfoRecicla — Panel de Administración
                        modular
                    </footer>
            </main>

        </div>
    </div>
    <script src="../components/load-components.js"></script>
</body>

</html-->

<!--DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Materiales</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid py-4">
        <!-- ====== MÓDULO: MATERIALES & CATÁLOGOS ====== >
        <section id="mod-materiales" class="mb-5">
            <h2 class="h5 text-success mb-2">Materiales & Catálogos</h2>
            <ul class="nav nav-pills mb-3">
                <li class="nav-item">
                    <a href="#materiales-resumen" class="nav-link active bg-success">Resumen</a>
                </li>
                <li class="nav-item">
                    <a th:href="@{/materiales/listado}" class="nav-link">Materiales</a>
                </li>
                <li class="nav-item">
                    <a th:href="@{/materiales/crear}" class="nav-link">Crear</a>
                </li>
                <li class="nav-item">
                    <a th:href="@{/tipos-material}" class="nav-link">Tipos</a>
                </li>
                <li class="nav-item">
                    <a th:href="@{/categorias}" class="nav-link">Categorías</a>
                </li>
            </ul>

            <div id="materiales-resumen" class="row g-3 mb-3">
                <div class="col-md-4">
                    <div class="card border-success h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-box text-success fa-2x mb-2"></i>
                            <div class="text-success fw-bold">Materiales</div>
                            <div class="display-6 text-success" th:text="${totalMateriales}">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-info h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-tags text-info fa-2x mb-2"></i>
                            <div class="text-info fw-bold">Categorías</div>
                            <div class="display-6 text-info" th:text="${totalCategorias}">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-warning h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-list-alt text-warning fa-2x mb-2"></i>
                            <div class="text-warning fw-bold">Tipos</div>
                            <div class="display-6 text-warning" th:text="${totalTipos}">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Materiales recientes >
            <div class="row">
                <div class="col-md-8">
                    <div class="card border-success">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-clock me-2"></i>Materiales Recientes
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr>
                                            <th>Nombre</th>
                                            <th>Categoría</th>
                                            <th>Tipo</th>
                                            <th class="text-end">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="material : ${materialesRecientes}">
                                            <td th:text="${material.nombre}">Nombre</td>
                                            <td>
                                                <span th:if="${material.categoria}" th:text="${material.categoria.nombre}" class="badge bg-info"></span>
                                                <span th:unless="${material.categoria}" class="badge bg-secondary">Sin categoría</span>
                                            </td>
                                            <td>
                                                <span th:if="${material.tipo}" th:text="${material.tipo.nombre}" class="badge bg-warning text-dark"></span>
                                                <span th:unless="${material.tipo}" class="badge bg-secondary">Sin tipo</span>
                                            </td>
                                            <td class="text-end">
                                                <a th:href="@{/materiales/ver/{id}(id=${material.id})}" class="btn btn-sm btn-outline-success">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a th:href="@{/materiales/editar/{id}(id=${material.id})}" class="btn btn-sm btn-outline-warning">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr th:if="${materialesRecientes.empty}">
                                            <td colspan="4" class="text-center text-muted">
                                                No hay materiales recientes
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card border-info">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-pie me-2"></i>Resumen por Categoría
                            </h6>
                        </div>
                        <div class="card-body">
                            <div th:each="stats : ${estadisticasCategorias}" class="mb-2">
                                <div class="d-flex justify-content-between small">
                                    <span th:text="${stats.categoriaNombre}">Categoría</span>
                                    <span th:text="${stats.total}" class="fw-bold"></span>
                                </div>
                                <div class="progress" style="height: 4px;">
                                    <div class="progress-bar" th:style="'width: ' + ${stats.porcentaje} + '%;'"></div>
                                </div>
                            </div>
                            <div th:if="${estadisticasCategorias.empty}" class="text-center text-muted small">
                                No hay datos disponibles
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html-->

<!-- Fragment: Dashboard Materiales -->
<section th:fragment="dashboard" class="container-fluid py-4">
    <!-- ====== MÓDULO: MATERIALES & CATÁLOGOS ====== -->
    <section id="mod-materiales" class="mb-5">
        <h2 class="h5 text-success mb-2">Materiales & Catálogos</h2>
        <ul class="nav nav-pills mb-3">
            <li class="nav-item">
                <a href="#materiales-resumen" class="nav-link active bg-success">Resumen</a>
            </li>
            <li class="nav-item">
                <a th:href="@{/materiales/listado}" class="nav-link">Materiales</a>
            </li>
            <li class="nav-item">
                <a th:href="@{/materiales/crear}" class="nav-link">Crear</a>
            </li>
            <li class="nav-item">
                <a th:href="@{/tipos-material}" class="nav-link">Tipos</a>
            </li>
            <li class="nav-item">
                <a th:href="@{/categorias}" class="nav-link">Categorías</a>
            </li>
        </ul>

        <div id="materiales-resumen" class="row g-3 mb-3">
            <div class="col-md-4">
                <div class="card border-success h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-box text-success fa-2x mb-2"></i>
                        <div class="text-success fw-bold">Materiales</div>
                        <div class="display-6 text-success" th:text="${totalMateriales}">0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-info h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-tags text-info fa-2x mb-2"></i>
                        <div class="text-info fw-bold">Categorías</div>
                        <div class="display-6 text-info" th:text="${totalCategorias}">0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-warning h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-list-alt text-warning fa-2x mb-2"></i>
                        <div class="text-warning fw-bold">Tipos</div>
                        <div class="display-6 text-warning" th:text="${totalTipos}">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Materiales recientes -->
        <div class="row">
            <div class="col-md-8">
                <div class="card border-success">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-clock me-2"></i>Materiales Recientes
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Categoría</th>
                                    <th>Tipo</th>
                                    <th class="text-end">Acciones</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="material : ${materialesRecientes}">
                                    <td th:text="${material.nombre}">Nombre</td>
                                    <td>
                                        <span th:if="${material.categoria}" th:text="${material.categoria.nombre}" class="badge bg-info"></span>
                                        <span th:unless="${material.categoria}" class="badge bg-secondary">Sin categoría</span>
                                    </td>
                                    <td>
                                        <span th:if="${material.tipo}" th:text="${material.tipo.nombre}" class="badge bg-warning text-dark"></span>
                                        <span th:unless="${material.tipo}" class="badge bg-secondary">Sin tipo</span>
                                    </td>
                                    <td class="text-end">
                                        <a th:href="@{/materiales/ver/{id}(id=${material.id})}" class="btn btn-sm btn-outline-success">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a th:href="@{/materiales/editar/{id}(id=${material.id})}" class="btn btn-sm btn-outline-warning">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr th:if="${materialesRecientes.empty}">
                                    <td colspan="4" class="text-center text-muted">
                                        No hay materiales recientes
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card border-info">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>Resumen por Categoría
                        </h6>
                    </div>
                    <div class="card-body">
                        <div th:each="stats : ${estadisticasCategorias}" class="mb-2">
                            <div class="d-flex justify-content-between small">
                                <span th:text="${stats.categoriaNombre}">Categoría</span>
                                <span th:text="${stats.total}" class="fw-bold"></span>
                            </div>
                            <div class="progress" style="height: 4px;">
                                <div class="progress-bar" th:style="'width: ' + ${stats.porcentaje} + '%;'"></div>
                            </div>
                        </div>
                        <div th:if="${estadisticasCategorias.empty}" class="text-center text-muted small">
                            No hay datos disponibles
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</section>