<!DOCTYPE html>
<html lang="es">

<head>
    <!-- =========================================
       HEAD: metadatos y estilos globales
       ========================================= -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>InfoRecicla — Gestión Punto ECA</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* ===== Estilos base del layout (solo CSS simple) ===== */
        body {
            background: #f8faf9;
        }

        .tab-card {
            background: #fff;
            border-radius: .75rem;
            box-shadow: 0 .5rem 1.25rem rgba(0, 0, 0, .06);
        }

        .sticky-tabs {
            position: sticky;
            top: 0;
            z-index: 1020;
            background: #f8faf9;
        }

        .table thead th {
            white-space: nowrap;
        }

        .sidebar-threads {
            max-height: 60vh;
            overflow: auto;
        }

        .chat-window {
            height: 50vh;
            overflow: auto;
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: .5rem;
            padding: 1rem;
        }

        .message {
            max-width: 80%;
            padding: .5rem .75rem;
            border-radius: .5rem;
            margin-bottom: .5rem;
        }

        .message.user {
            background: #e9f7ef;
            align-self: flex-start;
        }

        .message.eca {
            background: #e7f1ff;
            align-self: flex-end;
            margin-left: auto;
        }
    </style>
</head>

<body>

    <!-- =========================================
       NAVBAR: navegación superior
       - Mantiene marca y acciones globales
       ========================================= -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="/">
                <img src="/imagenes/logo.png" alt="Logo InfoRecicla" width="90" height="90" class="rounded">
                <span class="fs-1 fw-semibold">InfoRecicla</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
                aria-controls="nav" aria-expanded="false" aria-label="Alternar navegación">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div id="nav" class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto align-items-lg-center gap-2">
                    <li class="nav-item"><a class="nav-link" href="/publicaciones">Publicaciones</a></li>
                    <li class="nav-item"><a class="nav-link" href="/mapa">Mapa ECA</a></li>
                    <li class="nav-item"><a class="btn btn-light text-success fw-semibold" href="/">Salir</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- =========================================
       TABS: navegación por secciones del gestor
       - Usa Bootstrap Tabs
       - Se puede abrir por hash (#perfil, #inventario, etc.)
       ========================================= -->
    <div class="sticky-tabs border-bottom">
        <div class="container">
            <ul class="nav nav-tabs mt-3" id="ecaTabs" role="tablist">
                <!-- ===== MÓDULO: PERFIL ===== -->
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="perfil-tab" data-bs-toggle="tab" data-bs-target="#perfil"
                        type="button" role="tab">Perfil</button>
                </li>
                <!-- ===== MÓDULO: GESTIÓN DE INVENTARIO ===== -->
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="inventario-tab" data-bs-toggle="tab" data-bs-target="#inventario"
                        type="button" role="tab">Gestión de Inventario</button>
                </li>
                <!-- ===== MÓDULO: REGISTRO DE MATERIALES ===== -->
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="materiales-tab" data-bs-toggle="tab" data-bs-target="#materiales"
                        type="button" role="tab">Registro de Materiales</button>
                </li>
                <!-- ===== MÓDULO: HISTORIAL ===== -->
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="historial-tab" data-bs-toggle="tab" data-bs-target="#historial"
                        type="button" role="tab">Historial de Inventario</button>
                </li>
                <!-- ===== MÓDULO: PROVEEDORES ===== -->
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="proveedores-tab" data-bs-toggle="tab" data-bs-target="#proveedores"
                        type="button" role="tab">Proveedores</button>
                </li>
                <!-- ===== MÓDULO: CONVERSACIONES ===== -->
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="conversaciones-tab" data-bs-toggle="tab"
                        data-bs-target="#conversaciones" type="button" role="tab">Conversaciones</button>
                </li>
            </ul>
        </div>
    </div>

    <!-- =========================================
       MAIN: contenido de cada pestaña (tab-pane)
       ========================================= -->
    <main class="container my-4">
        <div class="tab-content" id="ecaTabsContent">

            <!-- =========================================
           TAB: PERFIL (encargado + punto ECA)
           - Aquí mostrarás/editarás info de BD: /api/eca/points/{id}
           ========================================= -->
            <section class="tab-pane fade show active" id="perfil" role="tabpanel" aria-labelledby="perfil-tab">
                <div class="row g-4">
                    <!-- ===== SUBMÓDULO: Datos del Encargado ===== -->
                    <div class="col-lg-6">
                        <div class="tab-card p-4">
                            <h5 class="mb-3">Encargado</h5>
                            <!-- Foto del encargado (archivo opcional) -->
                            <div class="d-flex align-items-center gap-3 mb-3">
                                <img id="previewPerfil" src="../images/perfil_default.png" alt="Foto encargado"
                                    class="rounded-circle img-thumbnail"
                                    style="width:96px;height:96px;object-fit:cover;">
                                <div>
                                    <div class="small text-muted">Foto (opcional)</div>
                                    <input class="form-control form-control-sm" type="file" id="fotoPerfil"
                                        accept="image/*">
                                </div>
                            </div>
                            <!-- Form de datos del encargado (mapea a eca_staff.owner o perfil de usuario) -->
                            <form id="formEncargado" class="row g-3">
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="mgrNombre" placeholder="—">
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Teléfono</label>
                                    <input type="tel" class="form-control" id="mgrTelefono" placeholder="—">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Correo</label>
                                    <input type="email" class="form-control" id="mgrEmail" placeholder="—">
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- ===== SUBMÓDULO: Datos del Punto ECA ===== -->
                    <div class="col-lg-6">
                        <div class="tab-card p-4">
                            <h5 class="mb-3">Punto ECA</h5>
                            <!-- Foto del punto (archivo opcional) -->
                            <div class="d-flex align-items-center gap-3 mb-3">
                                <img id="previewPunto" src="../images/eca-default.png" alt="Foto punto"
                                    class="img-thumbnail rounded" style="width:140px;height:100px;object-fit:cover;">
                                <div class="flex-grow-1">
                                    <div class="small text-muted">Foto (opcional)</div>
                                    <input class="form-control form-control-sm" type="file" id="fotoPunto"
                                        accept="image/*">
                                </div>
                            </div>

                            <!-- Form de datos del punto (mapea a eca_points) -->
                            <form id="formPunto" class="row g-3">
                                <div class="col-12">
                                    <label class="form-label">Nombre del Punto</label>
                                    <input type="text" class="form-control" id="puntoNombre" placeholder="—">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Dirección</label>
                                    <input type="text" class="form-control" id="puntoDireccion" placeholder="—">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Ciudad</label>
                                    <input type="text" class="form-control" id="puntoCiudad" placeholder="—">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Localidad</label>
                                    <input type="text" class="form-control" id="puntoLocalidad" placeholder="—">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Coordenadas</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="puntoLatLng"
                                            placeholder="Latitud, Longitud" readonly>
                                        <!-- Botón para pedir geoloc. del navegador -->
                                        <button class="btn btn-outline-secondary" type="button"
                                            id="btnUbicacion">Obtener ubicación</button>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Horario</label>
                                    <input type="text" class="form-control" id="puntoHorario"
                                        placeholder="Lun–Vie 8:00–17:00">
                                </div>
                            </form>

                            <div class="text-end mt-3">
                                <!-- Guardado (PATCH a tu API) -->
                                <button class="btn btn-success" id="btnGuardarPerfil">Guardar cambios</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- =========================================
           TAB: GESTIÓN DE INVENTARIO
           - Entradas rápidas y tabla resumen
           - BD: /api/eca/points/{id}/inventory
           ========================================= -->
            <section class="tab-pane fade" id="inventario" role="tabpanel" aria-labelledby="inventario-tab">
                <!-- ===== Form para registrar entrada ===== -->
                <div class="tab-card p-4 mb-4">
                    <h5 class="mb-3">Registrar Entrada de Material</h5>
                    <form id="formEntrada" class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Material</label>
                            <!-- Este catálogo podría venir de /api/materials -->
                            <select id="entMaterial" class="form-select" required>
                                <option value="" disabled selected>Seleccione un material</option>
                                <option>Papel y cartón</option>
                                <option>Plástico</option>
                                <option>Vidrio</option>
                                <option>Metales</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Stock (kg)</label>
                            <input type="number" class="form-control" id="entStock" min="0" step="0.01" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Cap. Máx. (kg)</label>
                            <input type="number" class="form-control" id="entCapMax" min="1" step="0.01" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Precio ($/kg)</label>
                            <input type="number" class="form-control" id="entPrecio" min="0" step="0.01" required>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-success w-100">Agregar</button>
                        </div>
                    </form>
                </div>

                <!-- ===== Tabla de inventario actual ===== -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Inventario Actual</h5>
                    <!-- Export futuro (CSV/PDF) -->
                    <button class="btn btn-outline-primary btn-sm" id="btnExportInventario">Exportar (futuro)</button>
                </div>

                <div class="tab-card p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0" id="tablaInventario">
                            <thead class="table-light">
                                <tr>
                                    <th>Material</th>
                                    <th>Stock (kg)</th>
                                    <th>Cap. Máx. (kg)</th>
                                    <th>Precio ($/kg)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- RELLENAR desde BD en el load de la pestaña -->
                                <tr>
                                    <td class="text-muted" colspan="4">Cargando…</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- =========================================
           TAB: REGISTRO DE MATERIALES
           - Alta de materiales y tabla de capacidad
           - BD: /api/materials y /api/eca/points/{id}/materials
           ========================================= -->
            <section class="tab-pane fade" id="materiales" role="tabpanel" aria-labelledby="materiales-tab">
                <!-- ===== Form para crear material ===== -->
                <div class="tab-card p-4 mb-4">
                    <h5 class="mb-3">Añadir Nuevo Material</h5>
                    <form id="formMaterial" class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Material</label>
                            <input type="text" class="form-control" id="matNombre" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Stock (kg)</label>
                            <input type="number" class="form-control" id="matStock" min="0" step="0.01" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Cap. Máx. (kg)</label>
                            <input type="number" class="form-control" id="matCapMax" min="1" step="0.01" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Precio ($/kg)</label>
                            <input type="number" class="form-control" id="matPrecio" min="0" step="0.01" required>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-success w-100">Registrar</button>
                        </div>
                    </form>
                </div>

                <!-- ===== Tabla de materiales con % de capacidad usada ===== -->
                <div class="tab-card p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0" id="tablaMateriales">
                            <thead class="table-light">
                                <tr>
                                    <th>Material</th>
                                    <th>Stock (kg)</th>
                                    <th>Cap. Disp. (%)</th>
                                    <th>Cap. Máx. (kg)</th>
                                    <th>Precio ($/kg)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- RELLENAR desde BD -->
                                <tr>
                                    <td class="text-muted" colspan="5">Cargando…</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- =========================================
           TAB: HISTORIAL DE INVENTARIO
           - Movimientos (IN/OUT)
           - BD: /api/eca/points/{id}/inventory/history
           ========================================= -->
            <section class="tab-pane fade" id="historial" role="tabpanel" aria-labelledby="historial-tab">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Historial de Movimientos</h5>
                    <!-- Export futuro PDF/CSV -->
                    <button class="btn btn-outline-primary btn-sm" id="btnExportHistorial">Descargar PDF
                        (futuro)</button>
                </div>

                <div class="tab-card p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0" id="tablaHistorial">
                            <thead class="table-light">
                                <tr>
                                    <th>ID</th>
                                    <th>Material</th>
                                    <th>Operación</th>
                                    <th>Peso (kg)</th>
                                    <th>Unidades</th>
                                    <th>Precio ($)</th>
                                    <th>Fecha</th>
                                    <th>Proveedor</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- RELLENAR desde BD -->
                                <tr>
                                    <td class="text-muted" colspan="8">Cargando…</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- =========================================
           TAB: PROVEEDORES
           - ABM de proveedores
           - BD: /api/eca/points/{id}/providers
           ========================================= -->
            <section class="tab-pane fade" id="proveedores" role="tabpanel" aria-labelledby="proveedores-tab">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Proveedores</h5>
                    <!-- Alta por modal -->
                    <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalProveedor">Nuevo
                        proveedor</button>
                </div>

                <div class="tab-card p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0" id="tablaProveedores">
                            <thead class="table-light">
                                <tr>
                                    <th>ID</th>
                                    <th>Proveedor</th>
                                    <th>Contacto</th>
                                    <th>Teléfono</th>
                                    <th>Email</th>
                                    <th>Dirección</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- RELLENAR desde BD -->
                                <tr>
                                    <td class="text-muted" colspan="6">Cargando…</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- =========================================
           TAB: CONVERSACIONES
           - Bandeja de hilos + chat
           - BD: /api/conversations (hilos) y /api/conversations/{id}/messages
           ========================================= -->
            <section class="tab-pane fade" id="conversaciones" role="tabpanel" aria-labelledby="conversaciones-tab">
                <div class="row g-3">
                    <!-- ===== Listado de hilos ===== -->
                    <div class="col-lg-4">
                        <div class="tab-card p-3">
                            <h6 class="mb-3">Conversaciones</h6>
                            <div class="list-group sidebar-threads" id="threadList">
                                <!-- RELLENAR hilos desde BD -->
                                <button class="list-group-item list-group-item-action active" data-thread-id="1">
                                    <div class="fw-semibold">Ciudadano A</div>
                                    <small class="text-muted">¿Dónde está el punto…?</small>
                                </button>
                                <button class="list-group-item list-group-item-action" data-thread-id="2">
                                    <div class="fw-semibold">Ciudadano B</div>
                                    <small class="text-muted">¿Aceptan plástico hoy?</small>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ===== Ventana de chat ===== -->
                    <div class="col-lg-8 d-flex flex-column">
                        <div class="chat-window d-flex flex-column mb-3" id="chatWindow">
                            <!-- RELLENAR mensajes desde BD -->
                            <div class="message user">¿Dónde está el punto de reciclaje más cercano?</div>
                            <div class="message eca">Estamos en la Calle 5 #123. Atendemos 8:00–17:00.</div>
                        </div>
                        <div class="input-group">
                            <input type="text" class="form-control" id="chatInput" placeholder="Escribe un mensaje…">
                            <button class="btn btn-success" id="chatSend">Enviar</button>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- =========================================
       MODAL: Alta de proveedor
       - POST /api/eca/points/{id}/providers
       ========================================= -->
    <div class="modal fade" id="modalProveedor" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form class="modal-content" id="formProveedor">
                <div class="modal-header">
                    <h5 class="modal-title">Nuevo proveedor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body row g-3">
                    <div class="col-12">
                        <label class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="provNombre" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Contacto</label>
                        <input type="text" class="form-control" id="provContacto" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Teléfono</label>
                        <input type="tel" class="form-control" id="provTelefono" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="provEmail" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Dirección</label>
                        <input type="text" class="form-control" id="provDireccion" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button class="btn btn-success" type="submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- =========================================
       TOAST: notificaciones breves (éxito/alertas)
       ========================================= -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
        <div id="toastOK" class="toast align-items-center text-white bg-success border-0" role="alert"
            aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toastText">Acción realizada.</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Cerrar"></button>
            </div>
        </div>
    </div>

    <!-- =========================================
       SCRIPTS: Bootstrap + lógica básica de pestañas
       ========================================= -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /* ===========================================================
           UTILIDADES GENERALES (toasts, tabs por hash, etc.)
           =========================================================== */
        const toastEl = document.getElementById('toastOK');
        const toast = new bootstrap.Toast(toastEl, { delay: 2000 });
        const toastText = document.getElementById('toastText');
        const showToast = (msg) => { toastText.textContent = msg; toast.show(); };

        // Abre la pestaña según el hash (permite /gestor-eca.html#inventario)
        function activateTabFromHash() {
            const hash = window.location.hash || '#perfil';
            const triggerEl = document.querySelector(`[data-bs-target="${hash}"]`);
            if (triggerEl) new bootstrap.Tab(triggerEl).show();
        }
        window.addEventListener('hashchange', activateTabFromHash);

        // Al cambiar de pestaña, actualizamos el hash y hacemos lazy-load
        document.getElementById('ecaTabs').addEventListener('shown.bs.tab', (e) => {
            const target = e.target.getAttribute('data-bs-target'); // ej. #inventario
            history.replaceState(null, '', target);

            /* ========= AQUÍ VAN TUS FETCHS POR PESTAÑA =========
               Ejemplos:
                 if (target === '#inventario')  loadInventario(pointId)
                 if (target === '#materiales')  loadMateriales(pointId)
                 if (target === '#historial')   loadHistorial(pointId)
                 if (target === '#proveedores') loadProveedores(pointId)
                 if (target === '#conversaciones') loadHilos(pointId)
            */
        });

        // Carga la pestaña inicial
        activateTabFromHash();

        /* ===========================================================
           PERFIL: geolocalización + guardado (simulado)
           =========================================================== */
        (function setupPerfil() {
            const btnUbicacion = document.getElementById('btnUbicacion');
            const latlng = document.getElementById('puntoLatLng');

            // Obtener coordenadas del navegador y reflejarlas en el input
            if (btnUbicacion) {
                btnUbicacion.addEventListener('click', () => {
                    if (!('geolocation' in navigator)) {
                        showToast('Tu navegador no soporta geolocalización.');
                        return;
                    }
                    btnUbicacion.disabled = true;
                    btnUbicacion.textContent = 'Obteniendo…';
                    navigator.geolocation.getCurrentPosition(
                        (pos) => {
                            const { latitude, longitude } = pos.coords;
                            latlng.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                            showToast('Ubicación obtenida.');
                            btnUbicacion.disabled = false;
                            btnUbicacion.textContent = 'Obtener ubicación';
                        },
                        () => {
                            showToast('No se pudo obtener la ubicación.');
                            btnUbicacion.disabled = false;
                            btnUbicacion.textContent = 'Obtener ubicación';
                        },
                        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                    );
                });
            }

            // Guardar perfil (simulado). A futuro: PATCH /api/eca/points/{id}
            const btnGuardarPerfil = document.getElementById('btnGuardarPerfil');
            btnGuardarPerfil.addEventListener('click', () => {
                // TODO: construir payload desde formEncargado y formPunto y enviar a tu API
                showToast('Perfil guardado (simulado).');
            });
        })();

        /* ===========================================================
           INVENTARIO: alta de entrada + tabla (simulado)
           =========================================================== */
        (function setupInventario() {
            // Alta rápida de entrada (IN). A futuro: POST /api/eca/points/{id}/inventory/entries
            const formEntrada = document.getElementById('formEntrada');
            formEntrada.addEventListener('submit', (e) => {
                e.preventDefault();
                // TODO: tomar valores, validar y enviar a la API
                showToast('Entrada registrada (simulado).');
            });

            // Carga inicial de tabla (placeholder). A futuro: reemplazar por fetch.
            const invTbody = document.querySelector('#tablaInventario tbody');
            if (invTbody && invTbody.children.length === 1) {
                invTbody.innerHTML = `
          <tr><td>Papel y cartón</td><td>120</td><td>200</td><td>600</td></tr>
          <tr><td>Plástico</td><td>85</td><td>150</td><td>1500</td></tr>
          <tr><td>Vidrio</td><td>210</td><td>300</td><td>800</td></tr>
          <tr><td>Metales</td><td>27</td><td>50</td><td>2500</td></tr>
        `;
            }
        })();

        /* ===========================================================
           MATERIALES: alta + tabla con % de capacidad (simulado)
           =========================================================== */
        (function setupMateriales() {
            const formMaterial = document.getElementById('formMaterial');
            formMaterial.addEventListener('submit', (e) => {
                e.preventDefault();
                // TODO: POST /api/materials o /api/eca/points/{id}/materials
                showToast('Material registrado (simulado).');
            });

            const matsTbody = document.querySelector('#tablaMateriales tbody');
            if (matsTbody && matsTbody.children.length === 1) {
                matsTbody.innerHTML = `
          <tr>
            <td>Papel y cartón</td><td>120</td>
            <td><div class="progress" style="max-width:180px;">
                  <div class="progress-bar bg-success" style="width:60%;">60%</div>
                </div></td>
            <td>200</td><td>600</td>
          </tr>
          <tr>
            <td>Plástico</td><td>85</td>
            <td><div class="progress" style="max-width:180px;">
                  <div class="progress-bar" style="width:57%;">57%</div>
                </div></td>
            <td>150</td><td>1500</td>
          </tr>
        `;
            }
        })();

        /* ===========================================================
           HISTORIAL: tabla de movimientos (simulado)
           =========================================================== */
        (function setupHistorial() {
            const histTbody = document.querySelector('#tablaHistorial tbody');
            if (histTbody && histTbody.children.length === 1) {
                histTbody.innerHTML = `
          <tr><td>1</td><td>Papel y cartón</td><td>IN</td><td>400</td><td>40</td><td>12000</td><td>2025-06-08 16:13</td><td>—</td></tr>
          <tr><td>2</td><td>Plástico</td><td>OUT</td><td>300</td><td>30</td><td>9000</td><td>2025-06-08 16:13</td><td>Recimetalcol</td></tr>
        `;
            }
            // TODO: GET /api/eca/points/{id}/inventory/history con paginación y filtros
        })();

        /* ===========================================================
           PROVEEDORES: modal de alta + tabla (simulado)
           =========================================================== */
        (function setupProveedores() {
            const formProveedor = document.getElementById('formProveedor');
            formProveedor.addEventListener('submit', (e) => {
                e.preventDefault();
                // TODO: POST /api/eca/points/{id}/providers
                const modal = bootstrap.Modal.getInstance(document.getElementById('modalProveedor'));
                modal.hide();
                showToast('Proveedor creado (simulado).');
            });

            const provTbody = document.querySelector('#tablaProveedores tbody');
            if (provTbody && provTbody.children.length === 1) {
                provTbody.innerHTML = `
          <tr><td>1</td><td>Reciclene S.A.S.</td><td>Juan Pérez</td><td>3205551234</td><td>juan@reciclene.com</td><td>Calle 10 #20-30</td></tr>
          <tr><td>2</td><td>Ecopositiva S.A.S.</td><td>Ana Torres</td><td>3109876543</td><td>ana@ecopositiva.com</td><td>Av. 19 #22-10</td></tr>
        `;
            }
            // TODO: GET /api/eca/points/{id}/providers
        })();

        /* ===========================================================
           CONVERSACIONES: hilos + mensajes (simulado)
           =========================================================== */
        (function setupConversaciones() {
            const threadList = document.getElementById('threadList');
            const chatWindow = document.getElementById('chatWindow');
            const chatInput = document.getElementById('chatInput');
            const chatSend = document.getElementById('chatSend');

            // Cambiar de hilo (simula carga)
            threadList.addEventListener('click', (e) => {
                const btn = e.target.closest('[data-thread-id]');
                if (!btn) return;
                document.querySelectorAll('#threadList .list-group-item').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // TODO: GET /api/conversations/{threadId}/messages
                chatWindow.innerHTML = '<div class="text-muted">Cargando mensajes…</div>';
                setTimeout(() => {
                    chatWindow.innerHTML = `
            <div class="message user">Hola, consulta del hilo ${btn.dataset.threadId}</div>
            <div class="message eca">¡Hola! ¿En qué puedo ayudarte?</div>
          `;
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                }, 400);
            });

            // Enviar mensaje (simulado)
            chatSend.addEventListener('click', () => {
                const text = chatInput.value.trim();
                if (!text) return;
                // TODO: POST /api/conversations/{threadId}/messages
                const bubble = document.createElement('div');
                bubble.className = 'message eca';
                bubble.textContent = text;
                chatWindow.appendChild(bubble);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                chatInput.value = '';
            });
        })();
    </script>
</body>

</html>